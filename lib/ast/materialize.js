'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = materialize;

var _jsItertools = require('@aureooms/js-itertools');

function materialize(root) {

	// assert root.type === 'node'

	var parents = [{
		type: 'node',
		nonterminal: root.nonterminal,
		production: root.production,
		children: []
	}];

	var children = [(0, _jsItertools.iter)(root.children)];

	while (true) {

		var todo = children.pop();

		var _todo$next = todo.next(),
		    done = _todo$next.done,
		    value = _todo$next.value;

		if (done) {
			if (children.length === 0) return parents.pop();else {
				var tree = parents.pop();
				var parent = parents.pop();
				parent.children.push(tree);
				parents.push(parent);
			}
		} else {

			var child = value;

			if (child.type === 'leaf') {
				var _tree = parents.pop();
				_tree.children.push(child);
				parents.push(_tree);
				children.push(todo);
			} else {

				var grandchildren = (0, _jsItertools.iter)(child.children);

				var newchild = {
					type: 'node',
					nonterminal: child.nonterminal,
					production: child.production,
					children: []
				};

				parents.push(newchild);
				children.push(todo);
				children.push(grandchildren);
			}
		}
	}
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hc3QvbWF0ZXJpYWxpemUuanMiXSwibmFtZXMiOlsibWF0ZXJpYWxpemUiLCJyb290IiwicGFyZW50cyIsInR5cGUiLCJub250ZXJtaW5hbCIsInByb2R1Y3Rpb24iLCJjaGlsZHJlbiIsInRvZG8iLCJwb3AiLCJuZXh0IiwiZG9uZSIsInZhbHVlIiwibGVuZ3RoIiwidHJlZSIsInBhcmVudCIsInB1c2giLCJjaGlsZCIsImdyYW5kY2hpbGRyZW4iLCJuZXdjaGlsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7a0JBRXdCQSxXOztBQUZ4Qjs7QUFFZSxTQUFTQSxXQUFULENBQXVCQyxJQUF2QixFQUE4Qjs7QUFFNUM7O0FBRUEsS0FBTUMsVUFBVSxDQUNmO0FBQ0NDLFFBQU8sTUFEUjtBQUVDQyxlQUFjSCxLQUFLRyxXQUZwQjtBQUdDQyxjQUFhSixLQUFLSSxVQUhuQjtBQUlDQyxZQUFXO0FBSlosRUFEZSxDQUFoQjs7QUFTQSxLQUFNQSxXQUFXLENBQUUsdUJBQU1MLEtBQUtLLFFBQVgsQ0FBRixDQUFqQjs7QUFFQSxRQUFRLElBQVIsRUFBZTs7QUFFZCxNQUFNQyxPQUFPRCxTQUFTRSxHQUFULEVBQWI7O0FBRmMsbUJBSVdELEtBQUtFLElBQUwsRUFKWDtBQUFBLE1BSU5DLElBSk0sY0FJTkEsSUFKTTtBQUFBLE1BSUNDLEtBSkQsY0FJQ0EsS0FKRDs7QUFNZCxNQUFLRCxJQUFMLEVBQVk7QUFDWCxPQUFLSixTQUFTTSxNQUFULEtBQW9CLENBQXpCLEVBQTZCLE9BQU9WLFFBQVFNLEdBQVIsRUFBUCxDQUE3QixLQUNLO0FBQ0osUUFBTUssT0FBT1gsUUFBUU0sR0FBUixFQUFiO0FBQ0EsUUFBTU0sU0FBU1osUUFBUU0sR0FBUixFQUFmO0FBQ0FNLFdBQU9SLFFBQVAsQ0FBZ0JTLElBQWhCLENBQXFCRixJQUFyQjtBQUNBWCxZQUFRYSxJQUFSLENBQWFELE1BQWI7QUFDQTtBQUNELEdBUkQsTUFVSzs7QUFFSixPQUFNRSxRQUFRTCxLQUFkOztBQUVBLE9BQUtLLE1BQU1iLElBQU4sS0FBZSxNQUFwQixFQUE2QjtBQUM1QixRQUFNVSxRQUFPWCxRQUFRTSxHQUFSLEVBQWI7QUFDQUssVUFBS1AsUUFBTCxDQUFjUyxJQUFkLENBQW1CQyxLQUFuQjtBQUNBZCxZQUFRYSxJQUFSLENBQWFGLEtBQWI7QUFDQVAsYUFBU1MsSUFBVCxDQUFjUixJQUFkO0FBQ0EsSUFMRCxNQU9LOztBQUVKLFFBQU1VLGdCQUFnQix1QkFBS0QsTUFBTVYsUUFBWCxDQUF0Qjs7QUFFQSxRQUFNWSxXQUFXO0FBQ2hCZixXQUFPLE1BRFM7QUFFaEJDLGtCQUFjWSxNQUFNWixXQUZKO0FBR2hCQyxpQkFBYVcsTUFBTVgsVUFISDtBQUloQkMsZUFBVztBQUpLLEtBQWpCOztBQU9BSixZQUFRYSxJQUFSLENBQWFHLFFBQWI7QUFDQVosYUFBU1MsSUFBVCxDQUFjUixJQUFkO0FBQ0FELGFBQVNTLElBQVQsQ0FBY0UsYUFBZDtBQUVBO0FBRUQ7QUFFRDtBQUVEIiwiZmlsZSI6Im1hdGVyaWFsaXplLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXRlciB9IGZyb20gJ0BhdXJlb29tcy9qcy1pdGVydG9vbHMnIDtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gbWF0ZXJpYWxpemUgKCByb290ICkge1xuXG5cdC8vIGFzc2VydCByb290LnR5cGUgPT09ICdub2RlJ1xuXG5cdGNvbnN0IHBhcmVudHMgPSBbXG5cdFx0e1xuXHRcdFx0dHlwZSA6ICdub2RlJyAsXG5cdFx0XHRub250ZXJtaW5hbCA6IHJvb3Qubm9udGVybWluYWwgLFxuXHRcdFx0cHJvZHVjdGlvbiA6IHJvb3QucHJvZHVjdGlvbiAsXG5cdFx0XHRjaGlsZHJlbiA6IFsgXSAsXG5cdFx0fVxuXHRdIDtcblxuXHRjb25zdCBjaGlsZHJlbiA9IFsgaXRlciggcm9vdC5jaGlsZHJlbiApIF0gO1xuXG5cdHdoaWxlICggdHJ1ZSApIHtcblxuXHRcdGNvbnN0IHRvZG8gPSBjaGlsZHJlbi5wb3AoKTtcblxuXHRcdGNvbnN0IHsgZG9uZSAsIHZhbHVlIH0gPSB0b2RvLm5leHQoKTtcblxuXHRcdGlmICggZG9uZSApIHtcblx0XHRcdGlmICggY2hpbGRyZW4ubGVuZ3RoID09PSAwICkgcmV0dXJuIHBhcmVudHMucG9wKCkgO1xuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdGNvbnN0IHRyZWUgPSBwYXJlbnRzLnBvcCgpO1xuXHRcdFx0XHRjb25zdCBwYXJlbnQgPSBwYXJlbnRzLnBvcCgpO1xuXHRcdFx0XHRwYXJlbnQuY2hpbGRyZW4ucHVzaCh0cmVlKTtcblx0XHRcdFx0cGFyZW50cy5wdXNoKHBhcmVudCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZWxzZSB7XG5cblx0XHRcdGNvbnN0IGNoaWxkID0gdmFsdWU7XG5cblx0XHRcdGlmICggY2hpbGQudHlwZSA9PT0gJ2xlYWYnICkge1xuXHRcdFx0XHRjb25zdCB0cmVlID0gcGFyZW50cy5wb3AoKTtcblx0XHRcdFx0dHJlZS5jaGlsZHJlbi5wdXNoKGNoaWxkKTtcblx0XHRcdFx0cGFyZW50cy5wdXNoKHRyZWUpO1xuXHRcdFx0XHRjaGlsZHJlbi5wdXNoKHRvZG8pO1xuXHRcdFx0fVxuXG5cdFx0XHRlbHNlIHtcblxuXHRcdFx0XHRjb25zdCBncmFuZGNoaWxkcmVuID0gaXRlcihjaGlsZC5jaGlsZHJlbikgO1xuXG5cdFx0XHRcdGNvbnN0IG5ld2NoaWxkID0ge1xuXHRcdFx0XHRcdHR5cGUgOiAnbm9kZScgLFxuXHRcdFx0XHRcdG5vbnRlcm1pbmFsIDogY2hpbGQubm9udGVybWluYWwgLFxuXHRcdFx0XHRcdHByb2R1Y3Rpb24gOiBjaGlsZC5wcm9kdWN0aW9uICxcblx0XHRcdFx0XHRjaGlsZHJlbiA6IFsgXSAsXG5cdFx0XHRcdH0gO1xuXG5cdFx0XHRcdHBhcmVudHMucHVzaChuZXdjaGlsZCk7XG5cdFx0XHRcdGNoaWxkcmVuLnB1c2godG9kbyk7XG5cdFx0XHRcdGNoaWxkcmVuLnB1c2goZ3JhbmRjaGlsZHJlbik7XG5cblx0XHRcdH1cblxuXHRcdH1cblxuXHR9XG5cbn1cbiJdfQ==